# build image from Docker Hub
build_image: adamwgoldberg/deepdive-github:unstable

language: scala
scala:
  - "2.10.3"
python:
  - "2.7"
jdk:
  - openjdk7
  - oraclejdk7

env: 
  global:
    - PGUSER=postgres
    - PGPASSWORD=""
    - PGPORT=5432
    - PGHOST=localhost
    - DBNAME=deepdive_test
    - LD_LIBRARY_PATH=/tmp/dw_linux/lib:/tmp/dw_linux/lib64:/tmp/dw_linux/lib/numactl-2.0.9
    
before_script:
  - sudo perl -pi -e 's/ssl = true/ssl = false/g' /etc/postgresql/9.3/main/postgresql.conf
  - sudo perl -pi -e 's/peer/trust/g' /etc/postgresql/9.3/main/pg_hba.conf
  - sudo service postgresql restart 
  - unzip lib/dw_linux.zip -d /tmp/
  - sudo -u postgres psql -c 'create database deepdive_test;'
script: 
  # Source .bashrc as Shippable does not do this automatically
  - source ~/.bashrc
  # Test DeepDive
  - pwd
  - ~/deepdive/test.sh 2>&1
